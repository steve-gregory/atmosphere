location /favicon.ico {
    alias {{ ATMOSPHERE_PATH }}/static/images/favicon.ico;
}

location /robots.txt {
   alias {{ ATMOSPHERE_PATH }}/static/templates/robots.txt;
}

location ~ "^/shell/(?<ipaddress>(\d{1,3}\.){3}\d{1,3})$" {
        rewrite "^/shell/(?<ipaddress>(\d{1,3}\.){3}\d{1,3})$" https://atmo-proxy.iplantcollaborative.org/?ssh=ssh://$ipaddress:22 permanent;
}

location /init_files {
   alias {{ ATMOSPHERE_PATH }}/init_files;
}

location /resources {
   alias {{ ATMOSPHERE_PATH }}/resources;
}

location /ws/ {
   rewrite  ^/(.*)  /$1 break;
   proxy_set_header X-Real-IP $remote_addr;
   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   proxy_set_header Host $http_host;
   proxy_redirect off;

   proxy_pass http://localhost:8080/;
   proxy_http_version 1.1;
   proxy_set_header Upgrade $http_upgrade;
   proxy_set_header Connection "upgrade";
}

location / {
   # Redirect to home page
   if ($request_uri ~ "^/$") {
      return 301 https://$host/application;
   }
   uwsgi_read_timeout 300;
   uwsgi_pass unix:///tmp/atmosphere.sock;
}
